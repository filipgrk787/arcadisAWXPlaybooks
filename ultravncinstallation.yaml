---
- name: Install UltraVNC from a network share
  hosts: all
  gather_facts: no
  tasks:
    - name: Create destination directory on Windows
      win_file:
        path: C:\Temp
        state: directory

    - name: Copy UltraVNC installer from network share to Windows machine
      win_shell: |
        net use Z: \\10.147.56.24\ibi 
        copy Z:\UltraVNC_1436_X86_Setup.exe C:\Temp\UltraVNC_1436_X86_Setup.exe
        net use Z: /delete
      args:
        executable: cmd

    - name: Install UltraVNC silently
      win_package:
        path: C:\Temp\UltraVNC_1436_X86_Setup.exe
        arguments: '/SILENT /NORESTART'

    - name: Ensure UltraVNC service is running
      win_service:
        name: "uvnc_service"
        start_mode: auto
        state: started

    - name: Clean up UltraVNC installer
      win_file:
        path: C:\Temp\UltraVNC_1436_X86_Setup.exe
        state: absent